<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø¨Ø·Ø§Ù‚Ø© ØªÙ‡Ù†Ø¦Ø© Ù…Ø¹ Cropper.js</title>
  <!-- Ø¥Ø¶Ø§ÙØ© Cropper.js CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" 
        integrity="sha512-t0BZZqPeXX6jrGU4vsU0F5S3PuOHKPNdxhCglEWTbZ3amSYUllMzIpfGGJk3g7XnGLHK3prn6dDFNsWsG9RH2g==" 
        crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    body {
      text-align: center;
      font-family: Tahoma, Arial, sans-serif;
      direction: rtl;
      background-color: #f0f0f0;
      margin: 0;
      padding: 20px;
    }
    .container {
      margin: auto;
      max-width: 800px;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
    }
    input, button {
      margin: 10px;
      padding: 8px;
      font-size: 16px;
    }
    #canvas {
      border: 1px solid #ccc;
      margin-top: 20px;
      display: none; /* Ø³ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø±Ø³Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
    }
    #downloadLink {
      display: none;
      margin-top: 20px;
      font-size: 18px;
      text-decoration: none;
      background-color: #4CAF50;
      color: #fff;
      padding: 10px 20px;
      border-radius: 5px;
    }
    #downloadLink:hover {
      background-color: #45a049;
    }
    /* ØªÙ†Ø³ÙŠÙ‚ Ù„Ø­Ø§ÙˆÙŠØ© Cropper */
    #cropperContainer {
      max-width: 500px;
      margin: 20px auto;
      display: none;
    }
    #cropperImage {
      width: 100%;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ğŸ‰ Ø§ØµÙ†Ø¹ Ø¨Ø·Ø§Ù‚Ø© ØªÙ‡Ù†Ø¦Ø© Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø± Ù…Ø¹ Ù…ÙƒØªØ¨ Ø§Ù„Ø£Ø³ØªØ§Ø° ØµØ¨Ø­Ù‰ Ø§Ù„Ø´Ù„Ù…Ù‡! ğŸ‰</h2>
    <!-- Ù†Ù…ÙˆØ°Ø¬ Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© -->
    <div>
      <input type="text" id="userName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
      <input type="file" id="userImage" accept="image/*">
      <button onclick="openCropper()">ÙØªØ­ Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
    </div>
    
    <!-- Ø­Ø§ÙˆÙŠØ© Ù„Ø¹Ø±Ø¶ ØµÙˆØ±Ø© cropper Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© -->
    <div id="cropperContainer">
      <img id="cropperImage" src="" alt="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©">
      <br>
      <button onclick="cropImage()">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù‚Øµ</button>
    </div>
    
    <!-- Canvas Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© -->
    <canvas id="canvas" width="800" height="1000"></canvas>
    <br>
    <a id="downloadLink" download="ØªÙ‡Ù†Ø¦Ø©_Ø¹ÙŠØ¯_Ø§Ù„ÙØ·Ø±.png">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‡Ù†Ø¦Ø©</a>
  </div>

  <!-- Ø¥Ø¶Ø§ÙØ© Cropper.js JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js" 
          integrity="sha512-QwSGFmV9++QRRZxUpY1wbzG2F+J3XhHS2PP/GzR+BgrwMeZ+R6G7eVRRNtPG0EWB/B0CAgprWT9W4g2DpqejKA==" 
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  
  <script>
    let cropper;
    let croppedImageDataURL;
    
    // ÙØªØ­ Ø£Ø¯Ø§Ø© Cropper Ø¨Ø¹Ø¯ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
    function openCropper() {
      const imageInput = document.getElementById('userImage').files[0];
      if (!imageInput) {
        alert("ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø©!");
        return;
      }
      const reader = new FileReader();
      reader.onload = function(event) {
        const cropperImage = document.getElementById('cropperImage');
        cropperImage.src = event.target.result;
        document.getElementById('cropperContainer').style.display = "block";
        if (cropper) {
          cropper.destroy();
        }
        cropper = new Cropper(cropperImage, {
          aspectRatio: 1,
          viewMode: 1,
          autoCropArea: 1
        });
      };
      reader.readAsDataURL(imageInput);
    }
    
    // Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù‚Øµ ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
    function cropImage() {
      if (cropper) {
        const canvasData = cropper.getCroppedCanvas({
          width: 300,
          height: 300
        });
        croppedImageDataURL = canvasData.toDataURL("image/png");
        // Ø¨Ø¹Ø¯ Ø§Ù„Ù‚ØµØŒ Ù†Ù†Ø´Ø¦ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…ÙÙ‚ØªØµØ©
        generateCard(croppedImageDataURL);
        document.getElementById('cropperContainer').style.display = "none";
      }
    }
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©
    function generateCard(croppedImageDataURL) {
      const name = document.getElementById("userName").value.trim();
      if (!name) {
        alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…!");
        return;
      }
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ© (bg.png) ÙˆØ§Ù„Ù„ÙˆØ¬Ùˆ (logo.png)
      const bg = new Image();
      bg.src = "bg.png";
      const logo = new Image();
      logo.src = "logo.png";
      let imagesLoaded = 0;
      bg.onload = checkImagesLoaded;
      logo.onload = checkImagesLoaded;
      function checkImagesLoaded() {
        imagesLoaded++;
        if (imagesLoaded === 2) {
          drawCard(croppedImageDataURL, bg, logo, name);
        }
      }
    }
    
    // Ø±Ø³Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ù€ Canvas
    function drawCard(userImgDataURL, bg, logo, name) {
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      // Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¹Ù„Ù‰ ÙƒØ§Ù…Ù„ Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù€ Canvas
      ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);
      
      // Ø±Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ù‚ØµÙˆØµØ© Ø¯Ø§Ø®Ù„ Ø¯Ø§Ø¦Ø±Ø©
      const userImg = new Image();
      userImg.src = userImgDataURL;
      userImg.onload = function() {
        const diameter = 300;
        const radius = diameter / 2;
        const circleCenterX = canvas.width / 2;
        const circleCenterY = 280; // Ø¥Ù†Ø²Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³ÙÙ„
        ctx.save();
        ctx.beginPath();
        ctx.arc(circleCenterX, circleCenterY, radius, 0, 2 * Math.PI);
        ctx.closePath();
        ctx.clip();
        ctx.drawImage(userImg, circleCenterX - radius, circleCenterY - radius, diameter, diameter);
        ctx.restore();
        
        // Ø±Ø³Ù… Ù…Ø³ØªØ·ÙŠÙ„ Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ø§Ù„ØºØ§Ù…Ù‚
        const rectWidth = 400;
        const rectHeight = 50;
        const rectX = (canvas.width - rectWidth) / 2;
        const rectY = circleCenterY + radius + 30;
        ctx.fillStyle = "#B8860B";
        ctx.fillRect(rectX, rectY, rectWidth, rectHeight);
        
        // ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø¨ÙŠØ¶
        ctx.fillStyle = "#fff";
        ctx.font = "bold 22px Tahoma";
        ctx.textAlign = "center";
        ctx.fillText(name, canvas.width / 2, rectY + 33);
        
        // ÙƒØªØ§Ø¨Ø© Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù†ØµÙˆØµ
        ctx.fillStyle = "#fff";
        ctx.font = "bold 26px Tahoma";
        ctx.fillText("Ø£Ù‡Ù†Ø¦ÙƒÙ…", canvas.width / 2, rectY + rectHeight + 60);
        ctx.fillText("Ø¨Ø­Ù„ÙˆÙ„ Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø± Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ", canvas.width / 2, rectY + rectHeight + 100);
        ctx.font = "20px Tahoma";
        ctx.fillText("ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ… Ø¨Ø®ÙŠØ±", canvas.width / 2, rectY + rectHeight + 140);
        ctx.fillText("ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡ Ù…Ù†Ø§ ÙˆÙ…Ù†ÙƒÙ… ØµØ§Ù„Ø­ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„", canvas.width / 2, rectY + rectHeight + 170);
        
        // Ø±Ø³Ù… Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ Ø¨Ø­Ø¬Ù… 240 (Ø£ÙƒØ¨Ø± Ø¨Ù…Ø±ØªÙŠÙ†)
        const logoSize = 240;
        const logoX = (canvas.width - logoSize) / 2;
        const logoY = canvas.height - logoSize - 30;
        ctx.drawImage(logo, logoX, logoY, logoSize, logoSize);
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù€ Canvas ÙˆØ±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„
        canvas.style.display = "block";
        const downloadLink = document.getElementById("downloadLink");
        downloadLink.href = canvas.toDataURL("image/png");
        downloadLink.style.display = "inline-block";
      };
    }
  </script>
</body>
</html>
