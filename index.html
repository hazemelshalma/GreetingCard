<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تهنئة عيد الفطر</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        #canvas-container { position: relative; display: none; }
        canvas { max-width: 100%; }
        #preview { width: 300px; height: 300px; overflow: hidden; margin: auto; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <h2> 🎉اصنع صورة تهنئة عيد الفطر المبارك مع مكتب الأستاذ صبحى الشلمه🎉 </h2>
    <input type="text" id="nameInput" placeholder="أدخل اسمك">
    <input type="file" id="imageInput" accept="image/*">
    <br><br>

    <!-- زر تحميل الصورة -->
    <button id="generateBtn" class="hidden">إنشاء التهنئة</button>

    <!-- عرض الصورة قبل القص -->
    <div id="preview-container" class="hidden">
        <h3>قص الصورة:</h3>
        <div id="preview">
            <img id="imagePreview">
        </div>
        <button id="cropBtn">اعتماد القص</button>
    </div>

    <!-- عرض التهنئة النهائية -->
    <div id="canvas-container">
        <h3>تهنئتك:</h3>
        <canvas id="finalCanvas"></canvas>
        <br>
        <a id="downloadBtn" class="hidden" download="تهنئة.png">تحميل التهنئة</a>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script>
        let cropper;
        const imageInput = document.getElementById("imageInput");
        const imagePreview = document.getElementById("imagePreview");
        const previewContainer = document.getElementById("preview-container");
        const cropBtn = document.getElementById("cropBtn");
        const generateBtn = document.getElementById("generateBtn");
        const finalCanvas = document.getElementById("finalCanvas");
        const canvasContainer = document.getElementById("canvas-container");
        const downloadBtn = document.getElementById("downloadBtn");
        const nameInput = document.getElementById("nameInput");

        // 📌 عند اختيار صورة، عرضها في مربع القص
        imageInput.addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    previewContainer.classList.remove("hidden");

                    // تفعيل Cropper.js بعد تحميل الصورة
                    if (cropper) cropper.destroy();
                    cropper = new Cropper(imagePreview, {
                        aspectRatio: 1, // قص الصورة بشكل مربع
                        viewMode: 2
                    });
                };
                reader.readAsDataURL(file);
            }
        });

        // 📌 عند الضغط على "اعتماد القص"
        cropBtn.addEventListener("click", function() {
            const croppedCanvas = cropper.getCroppedCanvas({ width: 300, height: 300 });
            const croppedImage = croppedCanvas.toDataURL("image/png");

            // إخفاء مربع القص
            previewContainer.classList.add("hidden");
            generateBtn.classList.remove("hidden");

            // تخزين الصورة للتهنئة
            generateBtn.dataset.croppedImage = croppedImage;
        });

        // 📌 عند الضغط على "إنشاء التهنئة"
        generateBtn.addEventListener("click", function() {
            const ctx = finalCanvas.getContext("2d");
            finalCanvas.width = 600;
            finalCanvas.height = 800;

            const bg = new Image();
            bg.src = "background.png"; // ضع خلفية التهنئة الخاصة بك هنا

            const userImage = new Image();
            userImage.src = generateBtn.dataset.croppedImage;

            bg.onload = function() {
                ctx.drawImage(bg, 0, 0, finalCanvas.width, finalCanvas.height);
                ctx.drawImage(userImage, 150, 50, 300, 300);

                ctx.fillStyle = "gold";
                ctx.fillRect(150, 380, 300, 50); // مستطيل الاسم

                ctx.font = "bold 30px Arial";
                ctx.fillStyle = "white";
                ctx.textAlign = "center";
                ctx.fillText(nameInput.value, 300, 415); // طباعة الاسم

                ctx.font = "bold 24px Arial";
                ctx.fillText("أهنئكم بحلول عيد الفطر المبارك", 300, 500);
                ctx.fillText("تقبل الله منا ومنكم صالح الأعمال", 300, 540);
                ctx.fillText("كل عام وأنتم بخير", 300, 580);

                // إظهار التهنئة
                canvasContainer.style.display = "block";
                downloadBtn.classList.remove("hidden");
                downloadBtn.href = finalCanvas.toDataURL("image/png");
            };
        });
    </script>

</body>
</html>
