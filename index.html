<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ‡Ù†Ø¦Ø© Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø±</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        #canvas-container { position: relative; display: none; }
        canvas { max-width: 100%; }
        #preview { width: 300px; height: 300px; overflow: hidden; margin: auto; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <h2> ğŸ‰Ø§ØµÙ†Ø¹ ØµÙˆØ±Ø© ØªÙ‡Ù†Ø¦Ø© Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø± Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ Ù…Ø¹ Ù…ÙƒØªØ¨ Ø§Ù„Ø£Ø³ØªØ§Ø° ØµØ¨Ø­Ù‰ Ø§Ù„Ø´Ù„Ù…Ù‡ğŸ‰ </h2>
    <input type="text" id="nameInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
    <input type="file" id="imageInput" accept="image/*">
    <br><br>

    <!-- Ø²Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© -->
    <button id="generateBtn" class="hidden">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‡Ù†Ø¦Ø©</button>

    <!-- Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ù‚Øµ -->
    <div id="preview-container" class="hidden">
        <h3>Ù‚Øµ Ø§Ù„ØµÙˆØ±Ø©:</h3>
        <div id="preview">
            <img id="imagePreview">
        </div>
        <button id="cropBtn">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù‚Øµ</button>
    </div>

    <!-- Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‡Ù†Ø¦Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© -->
    <div id="canvas-container">
        <h3>ØªÙ‡Ù†Ø¦ØªÙƒ:</h3>
        <canvas id="finalCanvas"></canvas>
        <br>
        <a id="downloadBtn" class="hidden" download="ØªÙ‡Ù†Ø¦Ø©.png">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‡Ù†Ø¦Ø©</a>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script>
        let cropper;
        const imageInput = document.getElementById("imageInput");
        const imagePreview = document.getElementById("imagePreview");
        const previewContainer = document.getElementById("preview-container");
        const cropBtn = document.getElementById("cropBtn");
        const generateBtn = document.getElementById("generateBtn");
        const finalCanvas = document.getElementById("finalCanvas");
        const canvasContainer = document.getElementById("canvas-container");
        const downloadBtn = document.getElementById("downloadBtn");
        const nameInput = document.getElementById("nameInput");

        // ğŸ“Œ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©ØŒ Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù‚Øµ
        imageInput.addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    previewContainer.classList.remove("hidden");

                    // ØªÙØ¹ÙŠÙ„ Cropper.js Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
                    if (cropper) cropper.destroy();
                    cropper = new Cropper(imagePreview, {
                        aspectRatio: 1, // Ù‚Øµ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø´ÙƒÙ„ Ù…Ø±Ø¨Ø¹
                        viewMode: 2
                    });
                };
                reader.readAsDataURL(file);
            }
        });

        // ğŸ“Œ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù‚Øµ"
        cropBtn.addEventListener("click", function() {
            const croppedCanvas = cropper.getCroppedCanvas({ width: 300, height: 300 });
            const croppedImage = croppedCanvas.toDataURL("image/png");

            // Ø¥Ø®ÙØ§Ø¡ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù‚Øµ
            previewContainer.classList.add("hidden");
            generateBtn.classList.remove("hidden");

            // ØªØ®Ø²ÙŠÙ† Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„ØªÙ‡Ù†Ø¦Ø©
            generateBtn.dataset.croppedImage = croppedImage;
        });

        // ğŸ“Œ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‡Ù†Ø¦Ø©"
        generateBtn.addEventListener("click", function() {
            const ctx = finalCanvas.getContext("2d");
            finalCanvas.width = 600;
            finalCanvas.height = 800;

            const bg = new Image();
            bg.src = "background.png"; // Ø¶Ø¹ Ø®Ù„ÙÙŠØ© Ø§Ù„ØªÙ‡Ù†Ø¦Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ù‡Ù†Ø§

            const userImage = new Image();
            userImage.src = generateBtn.dataset.croppedImage;

            bg.onload = function() {
                ctx.drawImage(bg, 0, 0, finalCanvas.width, finalCanvas.height);
                ctx.drawImage(userImage, 150, 50, 300, 300);

                ctx.fillStyle = "gold";
                ctx.fillRect(150, 380, 300, 50); // Ù…Ø³ØªØ·ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…

                ctx.font = "bold 30px Arial";
                ctx.fillStyle = "white";
                ctx.textAlign = "center";
                ctx.fillText(nameInput.value, 300, 415); // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø§Ø³Ù…

                ctx.font = "bold 24px Arial";
                ctx.fillText("Ø£Ù‡Ù†Ø¦ÙƒÙ… Ø¨Ø­Ù„ÙˆÙ„ Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø± Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ", 300, 500);
                ctx.fillText("ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡ Ù…Ù†Ø§ ÙˆÙ…Ù†ÙƒÙ… ØµØ§Ù„Ø­ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„", 300, 540);
                ctx.fillText("ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ… Ø¨Ø®ÙŠØ±", 300, 580);

                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙ‡Ù†Ø¦Ø©
                canvasContainer.style.display = "block";
                downloadBtn.classList.remove("hidden");
                downloadBtn.href = finalCanvas.toDataURL("image/png");
            };
        });
    </script>

</body>
</html>
